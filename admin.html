<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>News Editor</title>
</head>
<body>
  <h1>Update Ticker</h1>
  
  <label for="token">GitHub PAT:</label><br>
  <input type="password" id="token" placeholder="Paste your token here" style="width:60%"><br><br>

  <label for="tickerText">Ticker Text:</label><br>
  <textarea id="tickerText" rows="4" cols="50" placeholder="Enter new ticker message here..."></textarea><br><br>

  <button onclick="updateTicker()">Update</button>

  <script>
    async function updateTicker() {
      const token = document.getElementById('token').value.trim();
      const text = document.getElementById('tickerText').value.trim();

      if (!token || !text) {
        alert("Please enter both a token and ticker text.");
        return;
      }

      const url = 'https://api.github.com/repos/irishobserver/Irish-Observer-stuff/contents/ticker.json';

      try {
        // Step 1: Fetch current file to get SHA
        const res = await fetch(url, {
          method: 'GET',
          headers: {
            'Accept': 'application/vnd.github.v3+json',
            'Authorization': `Bearer ${token}`
          }
        });

        if (!res.ok) {
          throw new Error(`GitHub API GET failed: ${res.status}`);
        }

        const fileData = await res.json();

        // Step 2: Update content with new text
        const updatedContent = btoa(JSON.stringify({ text }));

        const updateRes = await fetch(url, {
          method: 'PUT',
          headers: {
            'Accept': 'application/vnd.github.v3+json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            message: 'Update ticker text',
            content: updatedContent,
            sha: fileData.sha
          })
        });

        if (!updateRes.ok) {
          const errText = await updateRes.text();
          throw new Error(`PUT failed: ${updateRes.status} — ${errText}`);
        }

        alert('✅ Ticker updated successfully!');
      } catch (error) {
        console.error(error);
        alert(`❌ Failed to update ticker: ${error.message}`);
      }
    }
  </script>
</body>
</html>
